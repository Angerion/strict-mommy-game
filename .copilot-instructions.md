# Strict Mommy Game - Copilot Instructions

## Project Overview

This is a survival-style web game built with **Svelte** and **Vite**. Players must manage various meters (hunger, thirst, cleanliness, oxygen, energy) while avoiding encounters with a "boss" character. The game features a tabbed interface with game and administration sections.

## Architecture

- **Frontend Framework**: Svelte 4.x
- **Build Tool**: Vite 4.x  
- **State Management**: Svelte stores
- **Audio**: Web Audio API with MP3 files
- **Styling**: Pure CSS (no framework)

## Directory Structure

```
/
├── .github/
│   └── workflows/
│       └── deploy.yml     # Railway deployment workflow
├── src/                   # Modern Svelte application
│   ├── main.js            # App entry point
│   ├── App.svelte         # Root component with tab navigation
│   ├── Game.svelte        # Main game logic and UI
│   ├── Admin.svelte       # Game configuration and settings
│   ├── stores.js          # Svelte stores for state management
│   └── style.css          # Modern CSS styles
├── public/
│   └── sounds/            # Game audio files (.mp3)
├── dist/                  # Production build output (generated)
├── index.html             # HTML entry point
├── vite.config.js         # Vite configuration
├── package.json           # Dependencies and scripts
├── .gitignore             # Git ignore patterns
├── script.js              # Legacy file (avoid modifying)
└── style.css              # Legacy file (avoid modifying)
```

## Component Hierarchy

```
App.svelte
├── Game.svelte            # Game mechanics, meters, encounters
└── Admin.svelte           # Settings, meter configuration
```

## State Management (stores.js)

The application uses Svelte stores for centralized state management:

### Game State Stores
- `gameTime` - Current game time in seconds
- `gameRunning` - Boolean indicating if game is active
- `gameWon` - Boolean indicating if player won
- `lives` - Current player lives count
- `isDown` - Boolean indicating if player is downed
- `isReviving` - Boolean indicating if player is reviving

### NPC/Boss State Stores  
- `npcStatus` - String describing current NPC status
- `bossAwake` - Boolean indicating if boss is awake
- `bossEncounterActive` - Boolean indicating active boss encounter

### Game Configuration Stores
- `meters` - Array of meter objects with properties:
  - `id` - Unique identifier
  - `name` - Display name
  - `value` - Current value (0-100)
  - `rate` - Decay rate per second
  - `replenish` - Amount restored when clicked
  - `color` - CSS gradient for visual styling
- `settings` - Object containing game configuration:
  - `startingLives` - Initial player lives
  - `doorbellMinTime` / `doorbellMaxTime` - Encounter timing range
  - `gameLengthMinutes` - Total game duration
  - `rustleMinPercent` / `rustleMaxPercent` - Rustle effect range

## Key Game Mechanics

### Meter System
- Players have 5 meters: Hunger, Thirst, Cleanliness, Oxygen, Energy
- Meters decay over time at configurable rates
- Players click meters to replenish them
- When a meter reaches 0, player loses a life and meter resets to 100

### Boss Encounter System
- Boss awakens at the top of each "game hour" (6 hours in a game = game length)
- During encounters, chase music plays and player can be "downed"
- Players can revive (8-second process) or use "Drop Aggro" button
- Encounters end when aggro is dropped or player revives

### Audio System
- Sound effects: doorbell, replenish, revive, rustle, grandfather clock
- Chase music: 5 random zombie chase tracks during boss encounters
- Audio files located in `public/sounds/`

## Development Workflow

### Setup
```bash
npm install          # Install dependencies
npm run dev         # Start development server
npm run build       # Build for production
npm run preview     # Preview production build
```

### Deployment
- Automatic deployment to Railway on GitHub releases
- Workflow defined in `.github/workflows/deploy.yml`
- Requires `RAILWAY_TOKEN` secret in repository settings

### Code Organization Guidelines

#### Svelte Components
- Use `<script>`, `<style>`, and markup sections
- Import stores at the component level
- Use reactive statements (`$:`) for computed values
- Subscribe to stores with `$storeName` syntax

#### State Updates
- Always use store methods: `storeName.set()`, `storeName.update()`
- Avoid direct mutation of store values
- Use derived stores for computed state

#### Styling
- Component-specific styles in `<style>` sections
- Global styles in `src/style.css`
- Use CSS custom properties for theming
- Responsive design with CSS Grid/Flexbox

## Common Development Tasks

### Adding New Meters
1. Update the `meters` store in `stores.js`
2. Add new meter object with `id`, `name`, `value`, `rate`, `replenish`, `color`
3. Styling will be handled automatically by existing CSS

### Modifying Game Settings
1. Update the `settings` store in `stores.js`
2. Add corresponding form controls in `Admin.svelte`
3. Ensure settings are applied in game logic in `Game.svelte`

### Adding New Audio
1. Place `.mp3` files in `public/sounds/`
2. Create `Audio` objects in component scripts
3. Call `.play()` method for sound effects
4. Use `.loop = true` for background music

### Debugging Tips
- Use browser DevTools to inspect Svelte stores
- Check console for audio loading errors
- Use Svelte DevTools browser extension
- Monitor network tab for asset loading issues

## File Modification Guidelines

### Actively Maintained Files
- `src/` directory - Main application code
- `index.html` - Entry point
- `vite.config.js` - Build configuration
- `package.json` - Dependencies

### Legacy Files (Avoid Modifying)
- `script.js` - Old vanilla JS implementation
- `style.css` (root level) - Legacy styles

### Configuration Files
- `.gitignore` - Already configured appropriately
- `package-lock.json` - Auto-generated, commit changes

## Testing and Quality Assurance

### Manual Testing
1. Start development server: `npm run dev`
2. Test both Game and Admin tabs
3. Verify meter functionality (clicking, decay, life loss)
4. Test boss encounter mechanics
5. Verify audio playback
6. Check responsive design

### Build Testing
1. Run production build: `npm run build`
2. Test with preview server: `npm run preview`
3. Verify all assets load correctly in production

## Performance Considerations

- Audio files are loaded on-demand
- Svelte stores provide efficient reactivity
- Vite handles code splitting and optimization
- CSS is component-scoped where possible

## Browser Compatibility

- Modern ES6+ features used
- Requires browsers supporting Web Audio API
- Tested on Chrome, Firefox, Safari, Edge